<div class="poster-rows" aria-hidden="true">
  <div class="row r1"><div class="inner"></div></div>
  <div class="row r2"><div class="inner"></div></div>
  <div class="row r3"><div class="inner"></div></div>
  <div class="row r4"><div class="inner"></div></div>
  <div class="row r5"><div class="inner"></div></div>
  <div class="row r6"><div class="inner"></div></div>
  <div class="row r7"><div class="inner"></div></div>
  <div class="row r8"><div class="inner"></div></div>
  <div class="row r9"><div class="inner"></div></div>
  <div class="row r10"><div class="inner"></div></div>
</div>

<!-- Modal overlay: sits between poster-rows (z:0) and sidebar (z:2) -->
<div class="modal-overlay" *ngIf="modalOverlayService.active()" aria-hidden="true"></div>

<!-- âœ… SIDEBAR -->
<nav class="sidebar" [class.active]="sidebarService.sidebarActive()" [class.no-anim]="sidebarService.suppressAnim()" *ngIf="showSidebar()">
    <div class="logo-menu">
        <h2 class="logo">FinalFeedback</h2>
        <i class="bx bx-menu toggle-button" (click)="sidebarService.toggle()"></i>
    </div>

    <ul class="list">
        <li class="list-item" [class.active]="isActive('/')">
            <a (click)="routingService.navigateToHome()">
                <i class="bx bx-home-alt"></i>
                <span class="link-name" [style.--i]="getNavDelay()[0]">Home</span>
            </a>
        </li>

        <li class="list-item" [class.active]="isActive('/search')">
            <a (click)="routingService.navigateToSearchAll()">
                <i class="bx bx-search"></i>
                <span class="link-name" [style.--i]="getNavDelay()[1]">Search</span>
            </a>
        </li>

        <li class="list-item" [class.active]="isActive('/messages')" [class.disabled]="authResolved() && !isAuthenticated()">
            <a (click)="isAuthenticated() ? routingService.navigateToMessages() : onDisabledNavClick()">
                <i class='bx bx-message'></i>
                <span class="link-name" [style.--i]="getNavDelay()[2]">Messages</span>
            </a>
        </li>

        <li class="list-item" [class.active]="isActive('/library')" [class.disabled]="authResolved() && (!isAuthenticated() || !hasRatings())">
            <a (click)="isAuthenticated() && hasRatings() ? routingService.navigateToLibrary() : onDisabledNavClick()">
                <i class='bx bx-list-ul'></i>
                <span class="link-name" [style.--i]="getNavDelay()[3]">Library</span>
            </a>
        </li>

        <li class="list-item" [class.active]="isActive('/summary')" [class.disabled]="authResolved() && !isAuthenticated()">
            <a (click)="isAuthenticated() ? routingService.navigateToSummary() : onDisabledNavClick()">
                <i class='bx bx-bar-chart-alt-2'></i>
                <span class="link-name" [style.--i]="getNavDelay()[4]">Summary</span>
            </a>
        </li>

        <li class="list-item" [class.active]="isActive('/account')" [class.disabled]="authResolved() && !isAuthenticated()">
            <a (click)="isAuthenticated() ? routingService.navigateToAccountsPosts(currentUser()!.username) : onDisabledNavClick()">
                <i class="bx bx-user"></i>
                <span class="link-name" [style.--i]="getNavDelay()[5]">Account</span>
            </a>
        </li>

        <li class="list-item" [class.active]="isActive('/notifications')" [class.disabled]="authResolved() && !isAuthenticated()">
            <a (click)="isAuthenticated() ? routingService.navigateToNotifications() : onDisabledNavClick()">
                <i class='bx bx-bell'></i>
                <span class="link-name" [style.--i]="getNavDelay()[6]">Notifications</span>
                <span class="notification-badge" *ngIf="isAuthenticated() && notificationsService.unreadCount() > 0">
                    {{ notificationsService.unreadCount() > 99 ? '99+' : notificationsService.unreadCount() }}
                </span>
            </a>
        </li>

        <li class="list-item" [class.active]="isSettingsActive()" [class.disabled]="authResolved() && !isAuthenticated()">
            <a (click)="isAuthenticated() ? routingService.navigateToSettings() : onDisabledNavClick()">
                <i class="bx bx-cog"></i>
                <span class="link-name" [style.--i]="getNavDelay()[7]">Settings</span>
            </a>
        </li>

        <ng-container *ngIf="isSettingsActive() && isAuthenticated()">
            <li class="settings-item" [class.active]="isActiveSettings('/settings/account-info')">
                <a (click)="routingService.navigateToSettings()">
                    <i class='bx bx-info-circle'></i>
                    <span class="link-name" [style.--i]="getNavDelay()[7]">Account Info</span>
                </a>
            </li>

            <li class="settings-item" [class.active]="isActiveSettings('/settings/privacy')">
                <a (click)="routingService.navigateToPrivacy()">
                    <i class='bx bx-shield-quarter'></i>
                    <span class="link-name" [style.--i]="getNavDelay()[7]">Privacy</span>
                </a>
            </li>

            <li class="settings-item" [class.active]="isActiveSettings('/settings/privacy-policy')">
                <a (click)="routingService.navigateToPrivacyPolicy()">
                    <i class='bx bx-clipboard'></i>
                    <span class="link-name" [style.--i]="getNavDelay()[7]">Privacy Policy</span>
                </a>
            </li>

            <li class="settings-item">
                <a (click)="showLogoutModal = true">
                    <i class='bx bx-exit'></i>
                    <span class="link-name" [style.--i]="getNavDelay()[7]">Log Out</span>
                </a>
            </li>
        </ng-container>

        <li class="username" *ngIf="currentUser() as cu">
            <p class="link-name" [style.--i]="getNavDelay()[8]">Signed in as:</p>
            <p class="link-name" [style.--i]="getNavDelay()[8]">{{ cu.username }}</p>
        </li>

        <li class="sign-in-item" *ngIf="!isAuthenticated()">
            <a class="sign-in-btn" (click)="routingService.navigateToLogin()">
                <i class='bx bx-log-in'></i>
                <span class="link-name" [style.--i]="getNavDelay()[8]">Sign In / Register</span>
            </a>
        </li>
    </ul>
</nav>

<router-outlet></router-outlet>

<app-logout-modal 
  *ngIf="showLogoutModal"
  (confirm)="onLogout()"
  (cancel)="showLogoutModal = false">
</app-logout-modal>